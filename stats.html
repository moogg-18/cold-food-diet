<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ä»Šæ—¥çµ±è¨ˆèˆ‡å»ºè­°</title>
  <link rel="stylesheet" href="style.css?v=130" />
</head>

<body>
  <header class="topbar">
    <h1>ğŸ“Š ä»Šæ—¥çµ±è¨ˆèˆ‡å»ºè­°</h1>
    <p class="sub"><a class="link" href="index.html">â† å›é¦–é </a></p>
  </header>

  <main class="container">

    <!-- ä»Šæ—¥æ‘˜è¦ -->
    <section class="panel">
      <h2>ä»Šæ—¥æ‘˜è¦</h2>

      <div class="grid">
        <div class="metric">
          <div class="label">ä»Šæ—¥ç¸½ç†±é‡</div>
          <div class="value" id="total">0</div>
          <div class="hint">kcal</div>
        </div>

        <div class="metric">
          <div class="label">å»ºè­°æ”å–é‡</div>
          <div class="value" id="limit">â€”</div>
          <div class="hint">kcal</div>
        </div>

        <div class="metric">
          <div class="label">å†·æ€§é£Ÿç‰©æ¬¡æ•¸</div>
          <div class="value" id="cold">0</div>
          <div class="hint">æ¬¡</div>
        </div>

        <div class="metric">
          <div class="label">ç†±é‡ç‹€æ…‹</div>
          <div class="value" id="statusText">â€”</div>
          <div class="hint" id="statusHint"></div>
        </div>
      </div>

      <p class="note" id="warn">â€”</p>
      <p class="note" id="tip">â€”</p>
    </section>

    <!-- âœ… æ–°å¢ï¼šä»Šæ—¥é£Ÿç‰©æ”å–ç´°é … -->
    <section class="panel food-detail-panel">
      <h2>ä»Šæ—¥é£Ÿç‰©æ”å–ç´°é …</h2>

      <div class="table-wrapper">
        <table class="food-table">
          <thead>
            <tr>
              <th>é¤åˆ¥</th>
              <th>é£Ÿç‰©åç¨±</th>
              <th>ç†±é‡ (kcal)</th>
              <th>æ˜¯å¦ç‚ºå†·æ€§é£Ÿç‰©</th>
            </tr>
          </thead>
          <tbody id="foodTableBody">
            <tr class="empty">
              <td colspan="4">å°šæœªæ–°å¢ä»»ä½•é£Ÿç‰©ç´€éŒ„</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- å¿«æ·å…¥å£ -->
    <section class="panel">
      <h2>å¿«æ·å…¥å£</h2>
      <a class="card" href="log.html">ğŸ± ç¹¼çºŒæ–°å¢ä¸‰é¤ç´€éŒ„</a>
      <a class="card" href="profile.html">ğŸ‘¤ å€‹äººè¨­å®š</a>
    </section>

  </main>

  <script src="app.js"></script>
  <script>
    /* ===== ä»Šæ—¥çµ±è¨ˆï¼ˆä½ åŸæœ¬çš„é‚è¼¯ï¼Œæœªå‹•ï¼‰ ===== */
    const s = window.App.getTodayStatus();

    document.getElementById("total").textContent = s.total;
    document.getElementById("cold").textContent = s.coldCount;
    document.getElementById("tip").textContent = "ğŸ’¡ å»ºè­°ï¼š" + s.tip;

    const limitEl = document.getElementById("limit");
    const statusTextEl = document.getElementById("statusText");
    const statusHintEl = document.getElementById("statusHint");
    const warnEl = document.getElementById("warn");

    if (!s.limit) {
      limitEl.textContent = "â€”";
      statusTextEl.textContent = "æœªè¨­å®š";
      statusHintEl.textContent = "";
      warnEl.textContent =
        "è«‹å…ˆåˆ°ã€Œå€‹äººè¨­å®šã€å¡«å¯«èº«é«˜ã€é«”é‡ã€å¹´é½¡ã€æ€§åˆ¥èˆ‡é‹å‹•é‡ï¼Œç³»çµ±æ‰èƒ½è¨ˆç®—å»ºè­°ç†±é‡ã€‚";
      warnEl.style.color = "#4d3900";
      warnEl.style.fontWeight = "600";
    } else {
      limitEl.textContent = s.limit;

      if (s.over) {
        statusTextEl.textContent = "è¶…æ¨™";
        statusHintEl.textContent = `+${s.overBy} kcal`;
        warnEl.textContent =
          `âš  ä»Šæ—¥ç†±é‡å·²è¶…éå»ºè­°æ”å–é‡ï¼ˆ+${s.overBy} kcalï¼‰ï¼Œå»ºè­°ä¸‹é¤é™ä½æ²¹ç³–æˆ–å¢åŠ è”¬èœ/è›‹ç™½è³ªæ¯”ä¾‹ã€‚`;
        warnEl.style.color = "red";
        warnEl.style.fontWeight = "800";
      } else {
        statusTextEl.textContent = "æ­£å¸¸";
        statusHintEl.textContent = "åœ¨ç¯„åœå…§";
        warnEl.textContent =
          "âœ” ç›®å‰ä»åœ¨å»ºè­°æ”å–ç¯„åœå…§ï¼ŒæŒçºŒä¿æŒå‡è¡¡é£²é£Ÿï¼";
        warnEl.style.color = "#7a8f4e";
        warnEl.style.fontWeight = "800";
      }
    }

    /* ===== ä»Šæ—¥é£Ÿç‰©æ”å–ç´°é …è¡¨æ ¼ ===== */
    function getLogsByDateSafe(d) {
      // å„ªå…ˆä½¿ç”¨ app.js æä¾›çš„ API
      if (window.App && typeof window.App.getLogsByDate === "function") {
        return window.App.getLogsByDate(d) || [];
      }

      // ä¿åº•ï¼šå˜—è©¦ localStorage
      const tryKeys = ["logs", "foodLogs", "mealLogs", "dietLogs"];
      for (const k of tryKeys) {
        const raw = localStorage.getItem(k);
        if (!raw) continue;

        try {
          const arr = JSON.parse(raw);
          if (Array.isArray(arr)) {
            return arr.filter(x => (x.date || x.d || x.day) === d);
          }
        } catch (_) {}
      }
      return [];
    }

    function renderFoodTableToday() {
      const today = window.App.todayISO();
      const tbody = document.getElementById("foodTableBody");
      const logs = getLogsByDateSafe(today);

      if (!logs || logs.length === 0) {
        tbody.innerHTML = `
          <tr class="empty">
            <td colspan="4">å°šæœªæ–°å¢ä»»ä½•é£Ÿç‰©ç´€éŒ„</td>
          </tr>`;
        return;
      }

      tbody.innerHTML = logs.map(item => {
        con
